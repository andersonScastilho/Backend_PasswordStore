"use strict";var h=Object.create;var n=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var y=(e,r)=>{for(var s in r)n(e,s,{get:r[s],enumerable:!0})},c=(e,r,s,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of E(r))!U.call(e,o)&&o!==s&&n(e,o,{get:()=>r[o],enumerable:!(t=I(r,o))||t.enumerable});return e};var R=(e,r,s)=>(s=e!=null?h(f(e)):{},c(r||!e||!e.__esModule?n(s,"default",{value:e,enumerable:!0}):s,e)),v=e=>c(n({},"__esModule",{value:!0}),e);var T={};y(T,{default:()=>P});module.exports=v(T);var u=require("@prisma/client"),l=new u.PrismaClient;var a=class{async show(r){return await l.user.findUnique({where:{id:r}})}};var i=R(require("jsonwebtoken")),d=class{constructor(r){this.showUserPerUserIdRepository=r}async validAuth(r){let[,s]=r.split(" ");if(!i.default.verify(s,process.env.TOKEN_SECRET??""))throw Error("Invalid token");let{id:o,email:m}=i.default.verify(s,process.env.TOKEN_SECRET??""),p=await this.showUserPerUserIdRepository?.show(o);if(m!==p?.email)throw Error("Invalid token");return o}async authentication(r,s){if(!await r.comparePasswords(s))throw Error("Invalid password");return i.default.sign({id:r.userId,email:r.userEmail},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}async authenticationProvider(r,s){return i.default.sign({id:r,email:s},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}},w=d;var P=async(e,r,s)=>{let{authorization:t}=e.headers;try{let o=new a;if(!t)return r.status(401).json({errors:["Login required"]});let p=await new w(o).validAuth(t);return e.params={...e.params,userId:p},s()}catch{return r.status(401).json({error:"Token expired or invalid"})}};
