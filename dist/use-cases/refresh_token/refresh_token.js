"use strict";var I=Object.create;var n=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var u=(o,r)=>{for(var e in r)n(o,e,{get:r[e],enumerable:!0})},c=(o,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of m(r))!y.call(o,s)&&s!==e&&n(o,s,{get:()=>r[s],enumerable:!(t=l(r,s))||t.enumerable});return o};var f=(o,r,e)=>(e=o!=null?I(R(o)):{},c(r||!o||!o.__esModule?n(e,"default",{value:o,enumerable:!0}):e,o)),U=o=>c(n({},"__esModule",{value:!0}),o);var v={};u(v,{RefreshToken:()=>h});module.exports=U(v);var p=f(require("dayjs"));var i=f(require("jsonwebtoken")),d=class{constructor(r){this.showUserPerUserIdRepository=r}async validAuth(r){let[,e]=r.split(" ");if(!i.default.verify(e,process.env.TOKEN_SECRET??""))throw Error("Invalid token");let{id:s,email:w}=i.default.verify(e,process.env.TOKEN_SECRET??""),a=await this.showUserPerUserIdRepository?.show(s);if(!a)throw Error("User not found");if(w!==a.email)throw Error("Invalid token");return s}async authentication(r,e){if(!await r.comparePasswords(e))throw Error("Invalid password");return i.default.sign({id:r.userId,email:r.userEmail},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}async authenticationProvider(r,e){return i.default.sign({id:r,email:e},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}},E=d;var h=class{constructor(r,e){this.showRefreshTokenRepository=r;this.showUserPerUserIdRepository=e}async execute(r){let e=await this.showRefreshTokenRepository.show(r);if(!e)throw Error("Refresh token invalid");let t=await this.showUserPerUserIdRepository.show(e.userId);if(!t)throw Error("User not found");if(t.verifiedEmail!==!0)throw Error("Unverified email");let s=new E;if((0,p.default)().isAfter(p.default.unix(e.expiresIn)))throw Error("Refresh_token expired");return await s.authenticationProvider(e.userId,t.email)}};0&&(module.exports={RefreshToken});
