"use strict";var U=Object.create;var n=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var T=(r,e)=>{for(var s in e)n(r,s,{get:e[s],enumerable:!0})},u=(r,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of R(e))!P.call(r,o)&&o!==s&&n(r,o,{get:()=>e[o],enumerable:!(t=v(e,o))||t.enumerable});return r};var k=(r,e,s)=>(s=r!=null?U(E(r)):{},u(e||!r||!r.__esModule?n(s,"default",{value:r,enumerable:!0}):s,r)),N=r=>u(n({},"__esModule",{value:!0}),r);var S={};T(S,{default:()=>c});module.exports=N(S);var I=require("zod");var i=k(require("jsonwebtoken")),m=class{constructor(e){this.showUserPerUserIdRepository=e}async validAuth(e){let[,s]=e.split(" ");if(!i.default.verify(s,process.env.TOKEN_SECRET??""))throw Error("Invalid token");let{id:o,email:d}=i.default.verify(s,process.env.TOKEN_SECRET??""),l=await this.showUserPerUserIdRepository?.show(o);if(d!==l?.email)throw Error("Invalid token");return o}async authentication(e,s){if(!await e.comparePasswords(s))throw Error("Invalid password");return i.default.sign({id:e.userId,email:e.userEmail},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}async authenticationProvider(e,s){return i.default.sign({id:e,email:s},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}},h=m;var a=class{constructor(e){this.showUserPerIdRepository=e}async execute(e){let t=await new h(this.showUserPerIdRepository).validAuth(e);return!!await this.showUserPerIdRepository.show(t)}};var w=require("@prisma/client"),f=new w.PrismaClient;var p=class{async show(e){return await f.user.findUnique({where:{id:e}})}};var x=I.z.string(),c=class{async handle(e,s,t){try{let o=x.parse(e.query.token);if(!o)return s.status(401).send("<h1>N\xE3o foi possivel validar seu e-mail</h1>");let d=new p,l=new a(d),y=`Bearer ${o}`;return await l.execute(y)===!1?s.status(400).send("<h1>N\xE3o foi possivel validar seu e-mail</h1>"):s.status(200).send("<h1>Email validado com sucesso</h1>")}catch{return s.status(400).send("<h1>N\xE3o foi possivel validar seu e-mail</h1>")}}};
