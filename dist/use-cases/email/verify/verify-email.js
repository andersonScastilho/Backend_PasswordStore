"use strict";var f=Object.create;var n=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var R=(e,r)=>{for(var s in r)n(e,s,{get:r[s],enumerable:!0})},m=(e,r,s,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of y(r))!P.call(e,t)&&t!==s&&n(e,t,{get:()=>r[t],enumerable:!(o=v(r,t))||o.enumerable});return e};var w=(e,r,s)=>(s=e!=null?f(U(e)):{},m(r||!e||!e.__esModule?n(s,"default",{value:e,enumerable:!0}):s,e)),T=e=>m(n({},"__esModule",{value:!0}),e);var k={};R(k,{VerifyEmail:()=>d});module.exports=T(k);var u=w(require("events"));var l=require("@prisma/client"),g=new l.PrismaClient;var a=class extends u.default{},E=new a;var i=w(require("jsonwebtoken")),p=class{constructor(r){this.showUserPerUserIdRepository=r}async validAuth(r){let[,s]=r.split(" ");if(!i.default.verify(s,process.env.TOKEN_SECRET??""))throw Error("Invalid token");let{id:t,email:I}=i.default.verify(s,process.env.TOKEN_SECRET??""),c=await this.showUserPerUserIdRepository?.show(t);if(!c)throw Error("User not found");if(I!==c.email)throw Error("Invalid token");return t}async authentication(r,s){if(!await r.comparePasswords(s))throw Error("Invalid password");return i.default.sign({id:r.userId,email:r.userEmail},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}async authenticationProvider(r,s){return i.default.sign({id:r,email:s},process.env.TOKEN_SECRET??"",{expiresIn:process.env.TOKEN_EXPIRATION})}},h=p;var d=class{constructor(r){this.showUserPerIdRepository=r}async execute(r){let o=await new h(this.showUserPerIdRepository).validAuth(r);return await this.showUserPerIdRepository.show(o)?(E.emit("user/verifiedEmail-update",o),!0):!1}};0&&(module.exports={VerifyEmail});
